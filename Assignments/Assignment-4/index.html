<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<title>COMP 411 Principles of Programming Languages</title>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Arial",sans-serif;
	color:black;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-right:0in;
	margin-left:0in;
	font-size:18.0pt;
	font-family:"Arial",sans-serif;
	color:black;
	font-weight:bold;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-right:0in;
	margin-left:0in;
	font-size:13.5pt;
	font-family:"Arial",sans-serif;
	color:windowtext;
	font-weight:bold;}
p.MsoBodyTextIndent, li.MsoBodyTextIndent, div.MsoBodyTextIndent
	{mso-style-link:"Body Text Indent Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Arial",sans-serif;
	color:black;}
a:link, span.MsoHyperlink
	{color:#0000EE;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:#551A8B;
	text-decoration:underline;}
p
	{margin-right:0in;
	margin-left:.5in;
	font-size:12.0pt;
	font-family:"Arial",sans-serif;
	color:black;}
pre
	{mso-style-link:"HTML Preformatted Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Courier New";
	color:windowtext;}
tt
	{font-family:"Courier New";}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Calibri Light",sans-serif;
	color:#2E74B5;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Calibri Light",sans-serif;
	color:#1F4D78;}
span.HTMLPreformattedChar
	{mso-style-name:"HTML Preformatted Char";
	mso-style-link:"HTML Preformatted";
	font-family:Consolas;
	color:black;}
span.BodyTextIndentChar
	{mso-style-name:"Body Text Indent Char";
	mso-style-link:"Body Text Indent";
	font-family:"Arial",sans-serif;
	color:black;}
p.class1, li.class1, div.class1
	{mso-style-name:class1;
	margin-right:0in;
	margin-left:.5in;
	font-size:12.0pt;
	font-family:"Arial",sans-serif;
	color:black;}
span.m
	{mso-style-name:m;}
.MsoChpDefault
	{font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body bgcolor=white lang=EN-US link="#0000EE" vlink="#551A8B" alink="#ff0000">

<div class=WordSection1>

<p class=MsoNormal>&nbsp; <u1:p></u1:p></p>

<table class=MsoNormalTable border=0 cellspacing=3 cellpadding=0 width="100%"
 style='width:100.0%' nosave="">
 <tr>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=class1><b><span style='font-size:48.0pt;color:#3366FF'>Programming
  Assignment 4:<br>
  Imperative Jam</span></b><span style='font-size:14.0pt'> </span></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal>&nbsp;</p>
  </td>
 </tr>
</table>

<h2><span style='font-size:20.0pt'>Points: 100</span></h2>

<h2 style='background:white'>Provided Code</h2>

<u1:p></u1:p>

<p style='background:white;font-variant-ligatures: normal;font-variant-caps: normal;
orphans: 2;text-align:start;widows: 2;-webkit-text-stroke-width: 0px;
text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;
word-spacing:0px'><span style='font-size:13.5pt'>The class solution to Project
3 appears in the support code for Project 4 on GitHub Classroom in a folder
named&nbsp;</span><b><span style='font-size:13.5pt;font-family:Consolas'>Solution
to Project 3</span></b><span style='font-size:13.5pt'>.  The provided code in
the folder </span><b><span style='font-size:13.5pt;font-family:Consolas'>src</span></b><span
style='font-size:13.5pt'> consists of a sample Junit test file </span><b><span
style='font-size:13.5pt;font-family:Consolas'>Assign4Test.java</span></b><span
style='font-size:13.5pt'> for Assignment 4.  In contrast to earlier
assignments, the provided code only includes a test file.  In this assignment,
you must extend and revise a solution to Project 3 (either the class solution
or your own) to support the additional Jam constructs.  The tests in provided
test file exercise these extensions.  Your project submission should have the
same layout as </span><b><span style='font-size:13.5pt;font-family:Consolas'>Solution
to Project 3</span></b><span style='font-size:13.5pt'> with the addition of </span><b><span
style='font-size:13.5pt;font-family:Consolas'>Assign4Test.java</span></b><span
style='font-size:13.5pt'> and your test files for Assignment 4.  You may
include the test files from</span><b><span style='font-size:13.5pt;font-family:
Consolas'> Solution to Project 3</span></b><span style='font-size:13.5pt'> in
your submission.  Recall that the names of your files do not matter except for
the fact that you test file names have the form </span><b><span
style='font-size:13.5pt;font-family:Consolas'>*Test.java</span></b><span
style='font-size:13.5pt'> (implying that the corresponding </span><b><span
style='font-size:13.5pt;font-family:Consolas'>public</span></b><span
style='font-size:13.5pt'> classes have names of the form </span><b><span
style='font-size:13.5pt;font-family:Consolas'>*Test</span></b><span
style='font-size:13.5pt'>) so that our grading script finds them.  Our grading
script expects the classes created by compiling the files in your submitted </span><b><span
style='font-size:13.5pt;font-family:Consolas'>src</span></b><span
style='font-size:13.5pt'> directory to be classes in the empty package
supporting the program API required by the sample test file </span><b><span
style='font-size:13.5pt;font-family:Consolas'>Assign4Test.java</span></b><span
style='font-size:13.5pt'>.  When compiled your program should pass the tests in
this sample test file.  </span></p>

<h3><span style='font-size:18.0pt'>Description</span></h3>

<p><b><span style='font-size:14.0pt'>Task</span></b><span style='font-size:
14.0pt'> &nbsp; </span></p>

<p>Your task is to extend and modify the nine interpreters from Project 3
(using either your solution or the provided class solution for Project 3) to
support imperative programming by adding ML-style reference cells and blocks.
In particular, you will augment the Jam dialect from Assignment 3 with the
unary operators <tt><b><span style='font-family:Consolas'>ref</span></b></tt>
and <tt><b><span style='font-family:Consolas'>!</span></b></tt>, the binary
assignment operator <tt><b><span style='font-family:Consolas'>&lt;-</span></b></tt>,
and blocks consisting of non-empty sequences of expressions enclosed in braces
(<tt><b><span style='font-family:Consolas'>{</span></b></tt> and <tt><b><span
style='font-family:Consolas'>}</span></b></tt>) and separated by semicolons
(the final expression in the sequence does NOT have a semicolon following it).
In other words, you need to support the following additions to Jam syntax:</p>

<pre style='margin-left:45.8pt'><b><span style='font-family:Consolas'>Exp           ::= ... | Block</span></b></pre><pre
style='margin-left:45.8pt'><b><span style='font-family:Consolas'>Block         ::= '{' PropStmtList '}'</span></b></pre><pre
style='margin-left:45.8pt'><b><span style='font-family:Consolas'>PropStmtList  ::= Exp { ; Exp}*</span></b></pre><pre
style='margin-left:45.8pt'><b><span style='font-family:Consolas'>Unop          ::= ... | ref | !</span></b></pre><pre
style='margin-left:45.8pt'><b><span style='font-family:Consolas'>Binop         ::= ... | &lt;-</span></b></pre><pre
style='margin-left:45.8pt'><b><span style='font-family:Consolas'>Prim          ::= ... | ref?</span></b></pre>

<p>Note that a <tt><b><span style='font-family:Consolas'>PropStmtList</span></b></tt>
is identical to a <tt><b><span style='font-family:Consolas'>PropExpList</span></b></tt>
except for the separator symbol <tt><b><span style='font-family:Consolas'>;</span></b></tt>
instead of <tt><b><span style='font-family:Consolas'>,</span></b></tt>. You may
want to exploit the commonality in your parser. We will use sometimes use the
word “statement&quot; instead of &quot;expression&quot; to refer to Jam
expressions because with the addition of mutable cells, evaluating an
expression can modify program state (the contents of mutable cells). From a
strictly syntactic viewpoint, there is no difference between statements and
expressions. But we still try to use the term <i>statement</i> to refer to an
expression where mutation is common and the term expression (more accurately <i>pure</i>
expression) where no mutation is avoided in well-written code. </p>

<p>You must modify your lexer and parser to accept <tt><b><span
style='font-family:Consolas'>Block</span></b></tt>s as well as the new unary
operators <tt><b><span style='font-family:Consolas'>ref</span></b></tt> and <tt><b><span
style='font-family:Consolas'>!, </span></b></tt>the new binary operator <tt><b><span
style='font-family:Consolas'>&lt;-</span></b></tt>, and the new primitive
function <tt><b><span style='font-family:Consolas'>ref?</span></b></tt>. The
supporting code for this assignment includes a class solution to Assignment 3. </p>

<p><strong><span style='font-size:14.0pt;font-family:"Arial",sans-serif'>Adding
ref cells and assignment</span></strong><span style='font-size:14.0pt'> </span></p>

<p>The unary operation <tt><b><span style='font-family:Consolas'>ref E</span></b></tt>
evaluates the expression <tt><b><span style='font-family:Consolas'>E</span></b></tt>
to produce an arbitrary value <tt><b><span style='font-family:Consolas'>V</span></b></tt>,
creates a new box <tt><b><span style='font-family:Consolas'>b</span></b></tt>
holding <tt><b><span style='font-family:Consolas'>V</span></b></tt> and returns
the box <tt><b><span style='font-family:Consolas'>b</span></b></tt>.</p>

<p>The unary operation <tt><b><span style='font-family:Consolas'>! E</span></b></tt>
evaluates the expression <tt><b><span style='font-family:Consolas'>E</span></b></tt>
to produce a value which must be a box and returns the contents of the box. If
the value of <tt><b><span style='font-family:Consolas'>E</span></b></tt> is not
a box, the interpreter generates a run-time error (<tt><b><span
style='font-family:Consolas'>EvalException</span></b></tt>).</p>

<p>The binary operation <tt><b><span style='font-family:Consolas'>E1 &lt;- E2</span></b></tt>
evaluates the expression <tt><b><span style='font-family:Consolas'>E1</span></b></tt>
to produce a value <tt><b><span style='font-family:Consolas'>V1</span></b></tt>
that must be a box, evaluates <tt><b><span style='font-family:Consolas'>E2</span></b></tt>
to produce an arbitrary value <tt><b><span style='font-family:Consolas'>V2</span></b></tt>,
stores <tt><b><span style='font-family:Consolas'>V2</span></b></tt> in box <tt><b><span
style='font-family:Consolas'>V1</span></b></tt>, and returns the special value <tt><b><span
style='font-family:Consolas'>JamUnit</span></b></tt> (which is a <em><span
style='font-family:"Arial",sans-serif'>legal Jam value</span></em> that is
rejected by most primitive operations as an invalid input). <tt><b><span
style='font-family:Consolas'>JamUnit</span></b></tt> can can conveniently be
represented as singleton subclass of <b><span style='font-family:Consolas'>JamVal</span></b>.
If you follow this recommendation, you will need to modify the <b><span
style='font-family:Consolas'>JamValVisitor</span></b> interface to include a <b><span
style='font-family:Consolas'>forXXXX</span></b> method for <tt><b><span
style='font-family:Consolas'>JamUnit</span></b></tt>.  (The <b><span
style='font-family:Consolas'>JamValVisitor</span></b> interface is not
currently used in the class solution to Project 4 but it important
infrastructure code should we every want to define an operation on the type <b><span
style='font-family:Consolas'>JamVal</span></b>.) We recommend that you use a
different representation for the dummy binding value in a recursive <b><span
style='font-family:Consolas'>let</span></b>; since attempting to access this
dummy value is a run-time error, the representation of this dummy value does
not need to be a <b><span style='font-family:Consolas'>JamVal</span></b>. The <b><span
style='font-family:Consolas'>null</span></b> pointer in Java can be used to
represent the dummy bound value in the implementation of recursive <span
style='font-family:Consolas'>let</span>; you can also introduce a special
object (as long as it is not a <b><span style='font-family:Consolas'>JamVal</span></b>)
for this purpose   The special value <tt><b><span style='font-family:Consolas'>JamUnit</span></b></tt>
can bound to a variable, returned by a <span style='font-family:Consolas'>map</span>,
and appear as an expression ins a block.  We recommend throwing an <b><span
style='font-family:Consolas'>EvalException</span></b> if <tt><b><span
style='font-family:Consolas'>JamUnit</span></b></tt> as passed as the input to
any operation other than the block construct, <b><span style='font-family:Consolas'>=</span></b>,
and type recognizers like <b><span style='font-family:Consolas'>number?</span></b>. 
Scheme is more liberal in its treatment of the <b><span style='font-family:
Consolas'>(void)</span></b> value; Scheme supports embedding <b><span
style='font-family:Consolas'>(void)</span></b> inside any data structure.  You
can follow this option in implementing Jam if you choose.  (You can use
DrRacket as a guide.)  None of the behavior of JamUnit will be tested in our
grading suites other than its use in blocks.</p>

<p>It <tt><b><span style='font-family:Consolas'>V1</span></b></tt> is not a
box, then the interpreter generates a run-time error. The <tt><b><span
style='font-family:Consolas'>JamUnit</span></b></tt> value can appear anywhere
in a computation, but many primitive operations (those for which it makes no
sense) reject it as an illegal input; it is analogous to the value <tt><b><span
style='font-family:Consolas'>(void)</span></b></tt> in Scheme.  </p>

<p>A box (reference cell) is a Jam value and can be returned as the result of
an expression. When converted to a string, the output of a box should appear as
<tt><b><span style='font-family:Consolas'>(ref&nbsp;&lt;value&gt;)</span></b></tt>.
This expression</p>

<p style='margin-left:45.8pt'><tt><b><span style='font-family:Consolas'>let x
:= ref 10; in {x &lt;- ref 17; x}</span></b></tt></p>

<p>should evaluate to the <b><span style='font-family:Consolas'>JamVal</span></b>
that is displayed as the string</p>

<p style='margin-left:45.8pt'><tt><b><span style='font-family:Consolas'>(ref
(ref 17))</span></b></tt></p>

<p>in call-by-value and call-by-need. In call-by-name evaluation, your
interpreter should display the string</p>

<p style='margin-left:45.8pt'><tt><b><span style='font-family:Consolas'>(ref
10)</span></b></tt></p>

<p class=MsoNormal style='margin-left:.5in'><span style='color:windowtext'>since
the binding of </span><b><span style='font-family:Consolas;color:windowtext'>x</span></b><span
style='color:windowtext'> is re-evaluated for every occurrence</span><span
style='font-family:"Times New Roman",serif;color:windowtext'>. </span></p>

<p>You will have to modify your <b><span style='font-family:Consolas'>toString</span></b>
method to support the correct display of boxes. Equality for boxes is based on
the address of the box, not the contents, i.e. the expression</p>

<p style='margin-left:45.8pt'><tt><b><span style='font-family:Consolas'>let x
:= ref 10; y := ref 10; in x = y</span></b></tt></p>

<p>evaluates to <tt><b><span style='font-family:Consolas'>false</span></b></tt>
regardless of the semantics for let (call-by-value, call-by-name,
call-by-need).</p>

<p>The primitive function <tt><b><span style='font-family:Consolas'>ref?</span></b></tt>
acts like all other type recognizers, e.g., <b><span style='font-family:Consolas'>number?</span></b>,
in that it accepts one argument, which can be of any type, but only returns <tt><b><span
style='font-family:Consolas'>true</span></b></tt> if that argument is a box,
and <tt><b><span style='font-family:Consolas'>false</span></b></tt> in all
other cases.</p>

<p><strong><span style='font-size:14.0pt;font-family:"Arial",sans-serif'>Adding
blocks</span></strong><span style='font-size:14.0pt'> &nbsp; </span></p>

<p>The block <tt><b><span style='font-family:Consolas'>{ <i>e</i></span></b></tt><tt><b><i><sub><span
style='font-family:"Arial",sans-serif'>1</span></sub></i></b></tt><tt><b><span
style='font-family:Consolas'>; ...; <i>e</i></span></b></tt><tt><i><sub><span
style='font-family:"Arial",sans-serif'>n</span></sub></i></tt><tt><b><span
style='font-family:Consolas'> }</span></b></tt>, <tt><i><span style='font-family:
"Arial",sans-serif'>n &gt; 0</span></i></tt>, evaluates <tt><b><i><span
style='font-family:Consolas'>e</span></i></b></tt><tt><b><i><sub><span
style='font-family:"Arial",sans-serif'>1</span></sub></i></b></tt>, ..., <tt><b><i><span
style='font-family:Consolas'>e</span></i></b></tt><tt><i><sub><span
style='font-family:"Arial",sans-serif'>n</span></sub></i></tt> in left-to-right
order and returns the value of <tt><b><i><span style='font-family:Consolas'>e</span></i></b></tt><tt><i><sub><span
style='font-family:"Arial",sans-serif'>n</span></sub></i></tt>. The expressions
<tt><b><i><span style='font-family:Consolas'>e</span></i></b></tt><tt><b><i><sub><span
style='font-family:"Arial",sans-serif'>1</span></sub></i></b></tt>, ... , <tt><b><i><span
style='font-family:Consolas'>e</span></i></b></tt><tt><i><sub><span
style='font-family:"Arial",sans-serif'>n</span></sub></i></tt> may evaluate to <tt><b><span
style='font-family:Consolas'>JamUnit</span></b></tt> (returned by the
assignment operator) without aborting the computation. In the Jam grammar, a <tt><b><span
style='font-family:Consolas'>Block</span></b></tt> is an additional form for an
expression analogous to <tt><b><span style='font-family:Consolas'>map</span></b></tt>,
<tt><b><span style='font-family:Consolas'>if</span></b></tt>, and <tt><b><span
style='font-family:Consolas'>let</span></b></tt>. Hence, it cannot appear as
the first argument in a binary expression unless it is enclosed in parentheses.
The “empty block” is a parser error (<tt><b><span style='font-family:Consolas'>ParseException</span></b></tt>).</p>

<p><strong><span style='font-family:"Arial",sans-serif'>Optional extra credit
(10 points)</span></strong> &nbsp; Devise Jam programs that exhibits different
behavior for eight of the nine modes of interpretation and run them from a unit
test suite. It should not generate a run-time error in any of the nine cases,
but it may diverge in one case so you should elide the unit test or set it up
to time out (which is outside the Java subset for this course). </p>

<p><b>Testing</b> &nbsp; You are expected to write unit tests for all of your
non-trivial methods or functions <em><span style='font-family:"Arial",sans-serif'>and
submit your test code as part of your program</span></em>. For more
information, refer back to <a href="../1/index.html">Assignment 1</a>.</p>

<p><strong><span style='font-family:"Arial",sans-serif'>All versions</span></strong>
&nbsp; The interface of all modes of Jam interpretation remains identical to
that in <a href="../3">Assignment 3</a>. </p>

<h3><span style='font-size:18.0pt'>Testing and Submitting Your Program</span></h3>

<p>The <b><span style='font-family:Consolas'>src</span></b> folder in the
provided code base only includes the Junit test file <b><span style='font-family:
Consolas'>Assign4Test.java</span></b>.  Make sure that your program passes the
sample unit tests in <b><span style='font-family:Consolas'>Assign1Test.java</span></b>,
<b><span style='font-family:Consolas'>Assign2Test.java</span></b>, and <b><span
style='font-family:Consolas'>Assign3Test.java</span></b>, which all appear in
the sample solution to Project 3.  You obviously need to add more test cases
than appear <b><span style='font-family:Consolas'>Assign4Test.java</span></b>.
You can add your tests to this file or create you own Junit test file for
Project 4.  You need to thoroughly test the interpretation of each new
construct, notably boxes and mutation.</p>

<p>As always, each class and non-trivial method in your program should be
preceded by a short&nbsp;<span style='font-size:14.0pt;font-family:Consolas'>javadoc</span>&nbsp;comment
stating precisely what it does.</p>

<p>Edit the <tt><b><span style='font-family:Consolas'>README</span></b></tt>
file for your repository so that it</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in'><span
style='font-size:10.0pt;font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>outlines the organization of your program, </p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in'><span
style='font-size:10.0pt;font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>specifies any compatible additions that you made the provided API
(not generally necessary), and</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in'><span
style='font-size:10.0pt;font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>specifes what testing process you used to confirm the correctness
of your program.</p>

<p class=MsoNormal style='margin-left:.5in'>Note that the <b><span
style='font-family:Consolas'>README</span></b> file is a GitHub “MarkDown”
file, text augmented by a few simple formatting annotations.  MarkDown (MD) is
much less powerful than HTML but much easier to use.  The webpage <b><a
href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">markdown-cheat-sheet</a></b>
is a good summary for learning MarkDown and a useful reference.</p>

<p class=MsoNormal style='margin-left:.5in;background:white'>Since your program
resides in a repository owned by our classroom, you do not need to do anything
to submit other than use the mechanism provided by GitHub Classroom to submit
your <i>remote</i> respository.</p>

<p>Please make sure to remove or disable all debugging output generated by
program. Excessive use of print statements considerably slows down your
interpreter and thus the testing of your project. If your interpreter generates
a timeout error because debug output drastically slows it down, you may not get
credit for the test cases that took too long.</p>

<h3>&nbsp;</h3>

<div>

<p class=MsoNormal><a href="../../">Back to course website</a></p>

</div>

</div>

</body>

</html>
